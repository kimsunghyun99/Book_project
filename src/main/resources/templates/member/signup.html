<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        form {
            max-width: 400px;
            margin: 0 auto;
        }
        label {
            display: block;
            margin-bottom: 8px;
        }
        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 16px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }

        input[type="radio"] {
            display: inline-block;
            vertical-align: middle; /* 수직 정렬 추가 */
            margin-bottom: 0; /* 여백 제거 */
        }

        label {
            display: inline-block;
            vertical-align: middle; /* 수직 정렬 추가 */
            margin-bottom: 8px;
        }

        form input[type="radio"] + input[type="radio"] {
            margin-left: 10px;
        }
    </style>

    <script>
        window.onload = () => {
            const btnRegister = document.querySelector('#btnRegister');
            btnRegister.addEventListener('click', async () => {

                if (username.value == '') {
                    alert("이름을 입력하세요.");
                    username.focus();
                    return false;
                }

                if (nickname.value == '') {
                    alert("닉네임을 입력하세요.");
                    nickname.focus();
                    return false;
                }

                if (telno.value == '') {
                    alert("전화번호를 입력하세요");
                    telno.focus();
                    return false;
                }
                const beforeTelno = telno.value;
                const afterTelno = beforeTelno.replace(/\-/ig, "").replace(/\ /ig, "").trim();
                telno.value = afterTelno;


                if (birthday.value == '') {
                    alert("생년월일을 입력하세요");
                    birthday.focus();
                    return false;
                }

                if (userid.value == '') {
                    alert("아이디를 입력하세요");
                    userid.focus();
                    return false;
                }


                const Userid = userid.value;
                let regexr = Userid.search(/^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/);

                if (regexr < 0) {
                    alert("이메일 형식을 제대로 맞춰주세요");
                    return false;
                }


                const Pass = password.value;
                const Pass1 = password1.value;
                if (Pass == '') {
                    alert("암호를 입력하세요");
                    password.focus();
                    return false;
                }
                if (Pass1 == '') {
                    alert("암호를 입력하세요");
                    password1.focus();
                    return false;
                }
                if (Pass != Pass1) {
                    alert("입력된 암호를 확인하세요.");
                    password1.focus();
                    return false;
                }


                const gender = document.querySelectorAll('input[name=gender]:checked');

                if (gender.length == 0) {
                    alert("성별을 선택하세요");
                    return false;
                }


                let num = Pass.search(/[0-9]/g); //0-9까지의 숫자가 들어 있는지 검색.검색해서 값이 없으면 -1을 리턴
                let eng = Pass.search(/[a-z]/ig); // i : 알파벳 대소문자 구분 없이 검색
                let spe = Pass.search(/[`~!@#$%^&*|\\\'\";:\/?]/ig); //특수문자가 포함되어 있는지 검색
                if (Pass.length < 8 || Pass.length > 20) {
                    alert("암호는 8자리 ~ 20자 이내로 입력해 주세요");
                    return false;
                } else if (Pass.search(/\s/) != -1) {
                    alert("암호는 공백 없이 입력해 주세요.");
                    return false;
                } else if (num < 0 || eng < 0 || spe < 0) {
                    alert("암호는 영문,숫자,특수문자를 혼합하여 입력해 주세요.");
                    return false;
                }

                if (zipcode.value == '') {
                    alert("우편번호를 입력하세요");
                    zipcode.focus();
                    return false;
                }
                if (detailaddr.value == '') {
                    alert("상세 주소를 입력하세요");
                    detailaddr.focus();
                    return false;
                }




                const formData = new FormData(RegistryForm);

                await fetch('/member/signup', {
                    method: 'POST',
                    body: formData
                }).then((response) => response.json())
                    .then((data) => {

                        if (data.message === 'GOOD') {
                            alert(decodeURIComponent(data.username) + '님, 회원 가입을 축하 드립니다.');
                            document.location.href = '/';
                        } else {
                            alert("서버 장애로 회원 가입에 실패했습니다.");
                        }
                    }).catch((error) => {
                        console.log("error = " + error);
                    });


            });
        }


                const searchAddr = () => {

                    if (addrSearch.value == '') {
                        alert("검색할 주소를 입력하세요");
                        addrSearch.focus();
                        return false;
                    }

                    window.open(
                        "/member/addrSearch?page=1&addrSearch=" + addrSearch.value,
                        "주소검색",
                        "width=950, height=540, top=50, left=50"
                    );
                }

                const idCheck = async () => {

                    const userid = document.querySelector("#userid");

                    await fetch('/member/idCheck', {
                        method: "POST",
                        body: userid.value,
                    }).then((response) => response.text())
                        .then((data) => {
                            const idCheckNotice = document.querySelector('#idCheckNotice');
                            if (data == 0)
                                idCheckNotice.innerHTML = "사용 가능한 아이디입니다.";
                            else {
                                idCheckNotice.innerHTML = "이미 사용중인 아이디입니다.";
                                //userid.value = '';
                                userid.focus();
                            }
                        });
                }






    </script>


</head>
<body>

<form id="RegistryForm" name="RegistryForm" method="POST" enctype="form-data">
    <h2>회원가입</h2>
    <label for="username">사용자 이름:</label>
    <input type="text" id="username" name="username" required>

    <label for="nickname">닉네임:</label>
    <input type="text" id="nickname" name="nickname" required>

    <label for="telno">번호:</label>
    <input type="text" id="telno" class="input_field" name="telno" required>

    <label for="birthday">생년월일:</label>
    <input type="text" id="birthday" class="input_field" name="birthday" required>


    <label for="userid">아이디:</label>
    <input type="text" id="userid" name="userid" placeholder="이메일 형식으로 작성해주세요" required>
    <label for="password">비밀번호:</label>
    <input type="password" id="password" name="password" required>

    <label for="password1">비밀번호 확인:</label>
    <input type="password" id="password1" name="password1" required>

    성별 :
    <label><input type="radio" name="gender" value="남성">남성</label>
    <label><input type="radio" name="gender" value="여성">여성<br></label>


    <input type="text" id="addrSearch" name="addrSearch" class="addrSearch" placeholder="주소를 검색합니다.">
    <input type="button" id="btn_addSearch" class="btn_addrSearch" value="주소검색" onclick="searchAddr()">
    <input type="text" id="zipcode" class="input_field" name="zipcode" placeholder="우편번호가 검색되어 입력됩니다." readonly>
    <input type="text" id="addr1" class="input_field" name="addr" placeholder="주소가 검색되어 입력됩니다." readonly>
    <input type="text" id="detailaddr" class="input_field" name="detailaddr" placeholder="상세 주소를 입력하세요">

    <input type="button" id="btnRegister" class="btn_write" value="가입하기">
</form>

</body>
</html>