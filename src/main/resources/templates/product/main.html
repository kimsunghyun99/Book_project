<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT커넥션</title>
    <style>
        @font-face {
            font-family: 'SBAggroB';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/SBAggroB.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'GmarketSansMedium';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f2ede9;
        }

        header {
            background: #ffc118;
            color: #FFF;
            text-align: center;
            padding: 10px;
        }

        nav {
            text-align: center;
            padding: 10px;
        }

        /*.product-row {*/
        /*    display: flex;*/
        /*    flex-wrap: wrap;*/
        /*    justify-content: space-between;*/
        /*}*/

        /*.product-item {*/
        /*    width: calc(50% - 10px);*/
        /*    margin-bottom: 20px;*/
        /*    font-family: 'GmarketSansMedium';*/
        /*}*/

        /*.product-item img {*/
        /*    width: 100%;*/
        /*    max-width: 100px;*/
        /*    height: auto;*/
        /*    border-radius: 5px;*/
        /*    border: 1px solid #ddd;*/
        /*}*/

        .product-row {
            width: 55%;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin: 0 auto;
            border: none;
            padding: 10px;
            box-sizing: border-box;
        }

        .product-item {
            width: calc(23% - 10px); /* 23%로 설정하여 4개씩 가로로 배치, 여유 공간을 주기 위해 23%로 조절 */
            margin-bottom: 20px;
            font-family: 'GmarketSansMedium';
            padding-left : 10px;

        }

        .product-item img {
            width: 100%;
            max-width: 200px;
            height: auto;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .product-title {
            font-size: 16px;
            padding-right: 10px;
            word-wrap: break-word;
        }


        section {
            padding: 20px;
            font-family: 'GmarketSansMedium';
            /*text-align: center;*/
        }

        .news-row {
            margin-bottom: 10px;
        }

        h2 {
            font-family: 'SBAggroB';
            font-size: 24px;
            margin-bottom: 20px;
        }
        h4 {
            font-family: 'SBAggroB';
            font-size: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        a {
            text-decoration: none;
            color: #333;
        }

        img {
            width: 100px;
            height: 150px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        a:hover {
            color: #007ACC;
        }

        #recentlyViewed {
            font-family: 'GmarketSansMedium';
            font-size: 10px;
            position: fixed;
            top: 25%;
            right: 0;
            width: 150px;
            height: auto;
            overflow: auto;
            background-color: #ffd153;
            padding: 10px;
            margin-right: 40px;
            /*margin-bottom: 100px;*/

        }

        footer {
            background-color: #ffdb7a;
            color: #FFF;
            text-align: center;
            padding: 10px;
            position: relative;
            bottom: 0;
            width: 100%;
        }

        .news-row, .event-row {
            margin-left:35%;
        }
    </style>

    <script>

        // localStorage.clear();
        function addProductToRecentlyViewed(bookid, bookname, cover) {
            console.log(bookid);
            console.log(cover);
            console.log(bookname);
            var product = {
                bookid: bookid,
                bookname: bookname,
                cover: cover
            };
            // 처음에 빈배열됨
            var recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];

            // 이미 저장된 상품인지 확인 후 중복 방지
            var existingProduct = recentlyViewed.findIndex(function (item) {
                return item.bookid === product.bookid;     // 이게 true면 있다는거
            });

            // 중복인 경우 , 해당 값 배열에서 삭제하기
            if(existingProduct != -1) {
                recentlyViewed.splice(existingProduct, 1);
                recentlyViewed.push(product);
            }

            if (existingProduct == -1) {
                // 새로운 상품을 추가
                recentlyViewed.push(product);
                // 최근 본 상품 목록을 로컬 스토리지에 저장
            }

            localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
        }

        window.onload = () =>  {
            var recentlyViewedDiv = document.getElementById('recentlyViewed');
            var recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
            var lastThreeProducts = recentlyViewed.slice(-3);

            var productContainer = document.createElement('div');
            productContainer.innerHTML = '<h2>최근 본 상품</h2>'
            recentlyViewedDiv.appendChild(productContainer);

            lastThreeProducts.forEach(function (product) {
                var productElement = document.createElement('div');
                productElement.innerHTML =  '<img src=' + product.cover + ' style="width:100px;height:100px;">';
                productElement.innerHTML =  productElement.innerHTML + '<h3>' + product.bookname + '</h3>';


                productElement.onmouseover = function () {
                    productElement.style.cursor = 'pointer'; // 커서 모양 변경
                };
                productElement.addEventListener('click',function() {
                    // ViewProductDetails(product.bookid);
                    window.location.href='/product/productInfo?bookid='+ product.bookid.replace(/"/g, '') + '&page=1';
                });

                recentlyViewedDiv.appendChild(productElement);

                // 안쪽
            });
        }


    </script>
</head>
<body>
<div th:include="/etc/header.html"></div>

<section>
    <h4>추천 도서</h4>
    <div class="product-row">

        <div class="product-item" th:each="product, stat : ${productList}" th:if="${stat.count <= 8}">
            <a th:href="@{'/product/productInfo?bookid=' + ${product.bookid} + '&page=1'}"
               th:onclick="addProductToRecentlyViewed('[[${product.bookid}]]', '[[${product.bookname}]]', '[[${product.cover}]]')">
                <img th:src="${product.cover}" alt="책 표지 이미지">
            </a>
            <div class="product-title">
            <p>
                <a th:href="@{'/product/productInfo?bookid=' + ${product.bookid} + '&page=1'}"
                   th:onclick="addProductToRecentlyViewed('[[${product.bookid}]]', '[[${product.bookname}]]', '[[${product.cover}]]')"
                   th:text="${product.bookname}">
                </a>
            </p></div>
        </div>
    </div>
</section>



<section class="news-row">
    <h2>IT New</h2>
    <div>
        <div th:each="news : ${newsList}">
            <tr style="font-size: 10px">
                <td>
                    <a th:href="${news.url}" th:text="${news.title}"></a>
                </td>
            </tr>
        </div>
    </div>
</section>

<section class="event-row">
    <h2>이벤트</h2>
    <p>※ 현재 이벤트 준비중입니다.</p>
</section>

<section>
    <div id="recentlyViewed">
        <!-- 이 부분에 최근 본 상품 정보를 동적으로 추가 -->
    </div>
</section>

<footer style="color:black">
    <p>&copy; 2024 IT커넥션 All rights reserved.</p>
    <p> 대한상공희의소 서울기술교육센터 기업프로젝트 SW 개발전문가 과정</p>
    <p>김성현 | 김정인 | 송윤주 | 조범주 </p>
</footer>
</body>
</html>
